<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Top Contributors</title>
	<style>
    body{
        margin:0px;
        margin-left:-40px;
        background-color:#F0ECE1;
        font-family: arial, sans-serif;
    }
    </style>
    <script type="text/javascript" src="http://www.google.com/jsapi"></script>
	<script>
	google.load("visualization", "1", {packages: ['corechart']});

	gup = function(name) {
  name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
  var regexS = "[\\?&]"+name+"=([^&#]*)";
  var regex = new RegExp( regexS );
  var results = regex.exec( window.location.href );
  if( results == null ) return "";
  else return results[1];
}

drawVisualization = function() {
  var queryText = decodeURIComponent(gup('sql'));
	var query = new google.visualization.Query('http://www.google.com/fusiontables/gvizdata?tq=' + queryText);
	query.send(getData);
}

function getData(response) {
	var dataTable = response.getDataTable();

	for (var i = 0; i < dataTable.getNumberOfRows();) {
		if (dataTable.getValue(i, 1) < 0) {
			dataTable.removeRow(i);
		} else {
			i++;
		}
	}

  google.visualization.drawChart({
    "containerId": "visualization",
    "dataTable": dataTable,
    "chartType": "PieChart",
    "options": {
      "legend": {textStyle: {color: 'black', fontName:'"Arial"', fontSize: 11}},
      "width": 400,
      "height" : 250,
      "is3D": true,
      "backgroundColor" : '#F0ECE1'
    }
  });
}
	</script>
</head>
	<body onload="drawVisualization();">
	<div id="visualization"></div>
</body>
</html>
